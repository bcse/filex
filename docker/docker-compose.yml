# Filex Docker Compose Configuration
#
# Basic usage:
#   docker-compose up -d
#
# To use with your own files, uncomment and modify the volume mount below.

services:
  filex:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: filex
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      # Mount your data directories here
      # Example: Mount a local folder
      # - /path/to/your/files:/data:rw
      #
      # Example: Mount multiple directories (requires configuring FM_ROOT_PATH or using symlinks)
      # - /path/to/photos:/data/photos:ro
      # - /path/to/documents:/data/documents:rw
      #
      # Persist the database (recommended)
      - filex_data:/app/data
    environment:
      # UID/GID mapping - set these to match your host user
      # Run 'id' on your host to find your UID/GID
      - PUID=1000
      - PGID=1000

      # Root path inside the container (usually /data)
      - FM_ROOT_PATH=/data

      # Background indexer settings
      - FM_ENABLE_INDEXER=true
      - FM_INDEX_INTERVAL=300  # seconds between index runs

      # Logging level: trace, debug, info, warn, error
      - RUST_LOG=info
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

volumes:
  filex_data:
    name: filex_data
